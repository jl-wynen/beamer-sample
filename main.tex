\documentclass[mathserif, fleqn]{beamer}
\input{settings.tex}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\section{A section}
\begin{frame}\frametitle{Overview}
  % different bullets just for this slide
  \setbeamertemplate{itemize item}{}
  \setbeamertemplate{itemize subitem}{\adfrightarrowhead}
  \setbeamertemplate{itemize subsubitem}{--}

  \begin{itemize}\setlength{\itemsep}{1.5ex}
  \item \textbf{Motivation}
    \begin{itemize}\setlength{\itemsep}{1ex}
    \item \LaTeX{} is `fun'
    \item Really nice slides if you put really much effort into it
    \end{itemize}
  \item \textbf{Method}
    \begin{itemize}\setlength{\itemsep}{1ex}
    \item Editor + \XeLaTeX
    \item PDF viewer
      \begin{itemize}
      \item Many choices
      \item Some good, some less so
      \item Watch out, sometimes coloured areas aren't merged properly!
      \end{itemize}
    \end{itemize}
  \item \textbf{Results}
    \begin{itemize}\setlength{\itemsep}{1ex}
    \item See for yourself
    \item Looks nice, doesn't it?
    \end{itemize}
  \end{itemize}

  \begin{aside}{40mm}{80mm,10mm}
    Note the special itemize markers on this slide
  \end{aside}

  \begin{aside}{30mm}{80mm,65mm}
    And you can place some neat extra notes
  \end{aside}
\end{frame}

\begin{frame}\frametitle{Stuff}
  \begin{itemize}
  \item This is the normal itemize style
    \begin{itemize}
    \item And sub items
      \begin{itemize}
      \item Boring on this level, but don't go here anyway!
      \end{itemize}
    \end{itemize}

  \item But look, nice serifs in equations (optional, maybe you need to distinguish those: $uv$):
    \begin{align*}
      \mathcal{C} = \frac1{Z} \braket{0|\int\,\mathcal{D}\psi\,e^{\i S}|0}
    \end{align*}

  \item Sideways fractions: $\sfrac{1}{2}$
  \end{itemize}
\end{frame}

\begin{frame}\frametitle{Advanced overlays}
  Changing colours and appearing underbrace:
  \begin{align*}
    \mathcal{C}_{SM}(n^2) \equiv \mathcal{F}_{n^2}\bigg(\; {\color<1,2>{aiphired}\sum_{\{\mathcal{B}^3\}}}\; {\color<-3>{white}\color<3->{aiphiblue}\underbrace{\color<1>{black}\color<2>{aiphiblue}\sum_I\, T_I \mathcal{B}^3_I}_{N}}\;\bigg)
  \end{align*}

  \begin{overprint}
    \onslide<1>
    \textbf{Pros and Cons list}
    \begin{itemize}\setlength\itemsep{1em}
    \item Use symmetries
    \item E.g. isosinglet $NN$ from just $\langle np\bar{n}\bar{p} \rangle$
      \addtolength{\itemindent}{.5mm}
    \item[\color{aiphigreen}\bfseries+] Very effective
      \addtolength{\itemindent}{-.5mm}
    \item[\color{aiphired}\bfseries--] Manual at the moment
    \end{itemize}

    \onslide<2>
    \textbf{Some more items}
    \begin{itemize}\setlength\itemsep{1em}
    \item $\mathcal{B}$ expensive $\Rightarrow$ reuse
      \addtolength{\itemindent}{.5mm}
    \item[\color{aiphigreen}\bfseries+] Automated, but \emph{Traveling Salesperson}
    \item[\color{aiphigreen}\bfseries+] Effective for 2N
      \addtolength{\itemindent}{-.5mm}
    \item[\color{aiphired}\bfseries--] $\color{aiphiblue}\sum_I$ dominates for 3N
    \end{itemize}

    \onslide<3>
    \textbf{Fancy slide with graph}
    \begin{columns}
      \begin{column}{.59\framewidth}
        \begin{itemize}\setlength\itemsep{1em}
        \item Put each unique combination of blocks on a vertex
        \item Weigh edges by number of shared blocks of connected vertices
        \item Find optimal path (maximum weight)
        \end{itemize}
      \end{column}
      \begin{column}{.4\framewidth}
        \begin{center}
          \begin{tikzpicture}
            \node (n0) at (0, 0) [circle, draw=aiphiblue, fill=aiphiblue!70!white, text=white, font=\fontsize{7}{0}\selectfont] {$N_0$};
            \node (n1) at (-2, -1) [circle, draw=aiphiblue, fill=aiphiblue!70!white, text=white, font=\fontsize{7}{0}\selectfont] {$N_1$};
            \node (n2) at (-1.5, -3) [circle, draw=aiphiblue, fill=aiphiblue!70!white, text=white, font=\fontsize{7}{0}\selectfont] {$N_2$};
            \node (n3) at (1, -2.5) [circle, draw=aiphiblue, fill=aiphiblue!70!white, text=white, font=\fontsize{7}{0}\selectfont] {$N_3$};
            \node (n4) at (1.5, -1) [circle, draw=aiphiblue, fill=aiphiblue!70!white, text=white, font=\fontsize{7}{0}\selectfont] {$N_4$};

            \draw (n0) -- node [rectangle, fill=white, text=aiphiblue] {1} (n1) [draw=aiphiblue, line width=.3mm];
            \draw (n0) -- node [rectangle, fill=white, text=aiphiblue] {2} (n4) [draw=aiphiblue, line width=.3mm];
            \draw (n3) -- node [rectangle, fill=white, text=aiphiblue] {2} (n4) [draw=aiphiblue, line width=.3mm];
            \draw (n0) -- node [rectangle, fill=white, text=aiphiblue] {2} (n3) [draw=aiphiblue, line width=.3mm];
            \draw (n1) -- node [rectangle, fill=white, text=aiphiblue] {1} (n2) [draw=aiphiblue, line width=.3mm];
            \draw (n2) -- node [rectangle, fill=white, text=aiphiblue] {1} (n3) [draw=aiphiblue, line width=.3mm];
          \end{tikzpicture}
        \end{center}
      \end{column}
    \end{columns}
  \end{overprint}
\end{frame}

\section{Second}
\subsection{First Sub}
% we need fragile so the code listing can position itself properly
\begin{frame}[fragile]\frametitle{Code!}
  \begin{cppcode}[caption={A test \cpp listing}]
// Some nice semi-meta function
template <typename It,
          template <typename...> class F,
          typename... TParam>
struct foreach {
  template <typename... Args>
  static void f(Args && ...args) {
    /* magic! */
    _internal::foreach_impl<typename It::Head,
                            typename It::Tail,
                            F,
                            TParam...>
        ::f(std::forward<Args>(args)...);

    std::cout << "Just testing syntax highlighting\n";
    char const c = 'c';
    std::vector<int> v{3};  // what is the length of this?
  }
};
  \end{cppcode}
\end{frame}

% fragile again (see above)
\begin{frame}[fragile]\frametitle{{\dvfamily Python} code}
  % set language of listings in this frame
  \begin{pycode}[caption={Some Python as well}]
# a hat in a cat
class cat:
  """A cat shaped like an arbitrary hat"""

  def __init__(self, shape):
    self._shape = shape

  def show(self):
    # watch out for auto line breaks:
    print(f"A {self._shape} shaped hat in a now {self._shape} shaped cat")

# highlight something in code, note that it doesn't play nice with the listing border
(*\hspace{-1.5mm}\begin{highlightbox}{}{\bfseries\color{aiphiblue!75!white}def} a\_very\_important\_function(cat):\end{highlightbox}*)
  cat.show()
\end{pycode}

{\scriptsize
  You can also
  \begin{highlightbox}{}\sffamily
    highlight stuff with a box
  \end{highlightbox}
  outside of code
}
\end{frame}

\begin{frame}[fragile]\frametitle{Pseudocode}
  \begin{aiphipseudo}[emph={isingmc}, caption={Some MC pseudocode}]
isingmc (cfg) -> E, m:
    (*\color{aiphigreen}E $\leftarrow$ hamiltonian(E)*)

    repeat ntherm:
        cfg(*\color{aiphigreen}, E*) <- sweep(cfg(*\color{aiphigreen}, E*))

    repeat nprod:
        cfg(*\color{aiphigreen}, E*) <- sweep(cfg(*\color{aiphigreen}, E*))
        (*\color{aiphired}E $\leftarrow$ hamiltonian(cfg)*)
        m <- magnetisation(cfg)

        // do something with E, m
  \end{aiphipseudo}
\end{frame}

\begin{frame}[fragile]\frametitle{Shell commands and files}
  % set style of listings in this frame
  % \lstset{style=aiphishell}
  \begin{itemize}
  \item First thing:
    \begin{shell}[]
mkdir <your-dir>
cd <your-dir>
    \end{shell}
  \item Then:
    \begin{shell}[]
git add <a-file>
git commit -m'Super meaningful message'  # the message is important!
    \end{shell}
  \item Files:
    \begin{shell}[]
cat wisdom.txt
    \end{shell}
    \begin{file}[]
Law of Continuity:
    Experiments should be reproducible.  They should all fail the same way.
    \end{file}
  \end{itemize}
\end{frame}

\begin{frame}\frametitle{Directory Trees (or directory-like files)}
  \begin{filebox}
    \begin{forest}
      for tree={
        font=\dvfamily,
        grow'=0,
        child anchor=west,
        parent anchor=south,
        anchor=west,
        calign=first,
        edge path={
          \noexpand\path [draw, \forestoption{edge}, black!60!white, line width=.3mm]
          ([xshift=7.5pt]!u.south west) |- node[fill,inner sep=.5mm] {} (.child anchor)\forestoption{edge label};
        },
        before typesetting nodes={
          if n=1
          {insert before={[,phantom]}}
          {}
        },
        fit=band,
        s sep=0mm,
        before computing xy={l=15pt},
      }
      [{\color{aiphired}.h5}
      [{\color{aiphipetrol}meta}
      [action \textnormal{\color{black!60!white}[source of function]}]
      [lattice \textnormal{\color{black!60!white}[YAML]}]
      [params \textnormal{\color{black!60!white}[YAML]}]
      ]
      [{\color{aiphipetrol}configuration}
      [0
      [action \textnormal{\color{black!60!white}[complex number]}]
      [phi \textnormal{\color{black!60!white}[complex lattice vector]}]
      [trajPoint \textnormal{\color{black!60!white}[integer]}]
      ]
      [\ldots, edge path={
        \noexpand\path [draw, \forestoption{edge}, dashed, black!60!white, line width=.3mm]
        ([xshift=7.5pt]!u.south west) |- ([xshift=-7.5pt].child anchor)\forestoption{edge label};
      }]
      ]
      [{\color{aiphipetrol}checkpoint}]
      [\textit{\color{aiphipetrol}<measurements>}]
      ]
    \end{forest}
  \end{filebox}
\end{frame}

\subsection{Blocks}
\begin{frame}\frametitle{Blocks}
  Quite nice but maybe boxes based on \texttt{tcolorbox} are better? See below.
  \begin{block}{A normal block}
    Some normal, boring text, but COLOURS!
  \end{block}
  \begin{exampleblock}{An example}
    This is how you do it.
  \end{exampleblock}
  \begin{alertblock}{Careful now}
    You should really watch out more!
  \end{alertblock}
\end{frame}

\begin{frame}\frametitle{Overlay boxes}
  \begin{textblock*}{60mm} (10mm,20mm)
    \begin{itembox}{first block}
      \begin{itemize}
      \item And-a one
      \item And-a two
      \item And-a
      \end{itemize}
    \end{itembox}
  \end{textblock*}

  \only<2->{
    \begin{textblock*}{60mm} (20mm,28mm)
      \begin{itembox}{second block}
        \begin{itemize}
        \item Foo
        \item Bar
        \item Baz
        \end{itemize}
      \end{itembox}
    \end{textblock*}
  }

  \only<3>{
    \begin{textblock*}{60mm} (30mm,36mm)
      \begin{itembox}{third block}
        \begin{itemize}
        \item En
        \item To
        \item Tre
        \item Fire
        \end{itemize}
      \end{itembox}
    \end{textblock*}
  }
\end{frame}

\begin{frame}\frametitle{Special boxes}
  \begin{fancybox}{Testing...}
    \lipsum[2]
  \end{fancybox}

  \begin{tagbox}{Title}{Tag}[aiphigreen][black]
    Tagged stuff
  \end{tagbox}
\end{frame}

{
  \usebackgroundtemplate{\begin{tikzpicture}
      \clip (0, 0) rectangle (\paperwidth, \paperheight);
      \filldraw[fill=aiphibackground] (-1, -1) rectangle (\paperwidth+1, \paperheight+1);
      \node[opacity=0.3] at (0.97\paperwidth, 0.96\paperheight) {\includegraphics[width=5cm, height=!]{background.pdf}};
    \end{tikzpicture}
  }
  \begin{frame}
    \begin{center}\huge
      A custom background\\
      \small\color{aiphitext!50!aiphibackground}
      (This one is optimised for the dark theme)
    \end{center}

    Use the \textbackslash{}usebackgroundtemplate command in the preamble to make this global.
    Then you can use \textbackslash{}plainbackground to disable the image per slide.
  \end{frame}
}

\begin{frame}[border=aiphipetrol]
  \begin{center}\huge
    A frame with a border
  \end{center}
\end{frame}

\begin{frame}[wip, fragile]
  \scriptsize
  Here is a handy guide for modifying colour in included PDFs:
  \begin{itemize}
  \item Uncompress PDF if necessary
    \begin{shell}[]
# check if it is compressed
strings wipsign.pdf | grep /Filter
# uncompress
qpdf --stream-data=uncompress image.pdf uncompressed.pdf
    \end{shell}
  \item Remove colour from content stream. For this, look for keys \verb$rg$ (fill colour), \verb$RG$ (line colour) in RGB model or \verb$k$ and \verb$K$ in YMCK model. The numbers before that are the colour values.
    Replace the first character in that command with \verb$%$ to comment out the line. \emph{Do not change the length of the file or positions of commands!}
  \item Recompress
    \begin{shell}[]
qpdf --stream-data=compress uncompressed.pdf image-no-colour.pdf
    \end{shell}
  \item Include graphic in \LaTeX, it will use the current text colour!
  \item See image in frame corner for result.
  \end{itemize}
\end{frame}

\begin{frame}\frametitle{Arrows}
  % mark start node n1 and target node t1
  Some text with a \tikzmark{n1}note\\[2ex]
  Some more text with a \tikzmark{t1}ref in the middle.
  % draw an arrow from n1 to t1
  \begin{tikzpicture}[remember picture, overlay]
    \draw[->, >=left to, line width=1mm, color=aiphibordeaux] ([yshift=0.5ex]pic cs:n1) to[bend right] ([yshift=0.5ex]pic cs:t1);
  \end{tikzpicture}

  \vspace{3ex}
  More fancy annotations:
  \begin{align*}
    \ket{\tikzmark{spin1}1, \tikzmark{magn1}m, \tikzmark{mom1}0} = \ldots
  \end{align*}
  % note the manual indent :/
  \hspace{6em}\tikzmark{mom2}Momentum\\
  \hspace{6em}\tikzmark{magn2}Spin projection\\
  \hspace{6em}\tikzmark{spin2}Total spin

  % draw lines and circles
  % all with manual adjustment of positions
  % manually place nodes to have control over the bullet size
  \begin{tikzpicture}[remember picture, overlay]
    \draw let
      \p1 = ([xshift=3pt, yshift=-3pt]pic cs:spin1),
      \p2 = ([xshift=-3pt, yshift=0.7ex]pic cs:spin2)
    in
      (\p1) .. controls (\x1,\y2) .. (\p2)
      node[shape=circle, fill=black, inner sep=1pt] {};

    \draw let
      \p1 = ([xshift=4pt, yshift=-3pt]pic cs:magn1),
      \p2 = ([xshift=-3pt, yshift=0.7ex]pic cs:magn2)
    in
      (\p1) .. controls (\x1,\y2) .. (\p2)
      node[shape=circle, fill=black, inner sep=1pt] {};

    \draw let
      \p1 = ([xshift=3pt, yshift=-3pt]pic cs:mom1),
      \p2 = ([xshift=-3pt, yshift=0.7ex]pic cs:mom2)
    in
      (\p1) .. controls (\x1,\y2) .. (\p2)
      node[shape=circle, fill=black, inner sep=1pt] {};
  \end{tikzpicture}
\end{frame}

% This is super slow with XeTeX!
% {
%   % show tiny text in background
%   % use \clip to fit the bounding box tightly to the tikz node
%   \usebackgroundtemplate{\begin{tikzpicture}
%       \clip (-.5\paperwidth,-.5\paperheight) rectangle (.5\paperwidth,.5\paperheight);
%       \node[text width=\paperwidth, color=gray, font=\fontsize{1}{0}\selectfont] {
%         \input{noise}
%       };
%     \end{tikzpicture}}
%   \begin{frame}\frametitle{Noise}
%     \begin{itemize}
%     \item Some background noise
%     \item Is it really just noise?\ldots
%     \end{itemize}
%   \end{frame}
% }

% % dirty trick to have the same slide number for both
% \addtocounter{framenumber}{-1}
% {
%   % show a magnified part of formula
%   \usebackgroundtemplate{\begin{tikzpicture}[spy using outlines]
%       \clip (-.5\paperwidth,-.5\paperheight) rectangle (.5\paperwidth,.5\paperheight);
%       \node[text width=\paperwidth, color=gray, font=\fontsize{1}{0}\selectfont] {
%         \input{noise}
%       };
%       \spy[black, circle, draw, size=5cm, magnification=6, connect spies] on (0,0) in node [fill=white] at (3.5,1.5);
%     \end{tikzpicture}}
%   % a copy of the above slide
%   \begin{frame}\frametitle{Noise}
%     \begin{itemize}
%     \item Some background noise
%     \item Is it really just noise?\ldots
%     \end{itemize}
%   \end{frame}
% }

\appendix
\backupbegin

\begin{frame}[plain]
  \begin{center}
    {\Huge\usebeamercolor[fg]{frametitle}Backup Slides}
  \end{center}
\end{frame}

\begin{frame}\frametitle{Appendix 1}
  Some extra stuff\\[2ex]
  Take a look at the progress bar!
\end{frame}

\begin{frame}\frametitle{Appendix 2}
  You can cite stuff in line: \icite{Paper}{How to write \LaTeX}\\
  Or special clickable refs: \arxiv{0000.0000}, \doi{0000}
\end{frame}

\backupend

\end{document}

%%% Local Variables:
%%% coding: utf-8
%%% mode: latex
%%% TeX-engine: xetex
%%% End: